<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Chill Runner</title>
    <link rel="stylesheet" href="style.css?v=" + Math.random() />
  </head>
  <body>
    <canvas id="gameCanvas"></canvas>

    <!-- Hidden container for preloading images -->
    <div style="display: none">
      <img id="playerImage" src="assets/player.png" alt="Player" />
      <img id="tokenImage" src="assets/token.png" alt="Token" />
      <img id="obstacleImage" src="assets/obstacle.png" alt="Obstacle" />
    </div>

    <script>
      // Prevent default touch behaviors
      document.addEventListener(
        "touchmove",
        function (e) {
          e.preventDefault();
        },
        { passive: false }
      );

      document.addEventListener(
        "touchstart",
        function (e) {
          e.preventDefault();
        },
        { passive: false }
      );

      // Image loading configuration
      const imagesToLoad = ["playerImage", "tokenImage", "obstacleImage"];
      let loadedImages = 0;

      function handleImageLoad() {
        loadedImages++;
        if (loadedImages === imagesToLoad.length) {
          console.log("All images loaded successfully");
          // All images loaded, now load the game
          const gameScript = document.createElement("script");
          gameScript.src = "game.js?v=" + Math.random();
          document.body.appendChild(gameScript);
        }
      }

      // Set up load handlers for all images
      imagesToLoad.forEach((imgId) => {
        const img = document.getElementById(imgId);

        if (img.complete) {
          console.log(`${imgId} already loaded`);
          handleImageLoad();
        } else {
          img.addEventListener("load", () => {
            console.log(`${imgId} loaded successfully`);
            handleImageLoad();
          });

          img.addEventListener("error", () => {
            console.error(`Failed to load ${imgId}`);
            handleImageLoad(); // Continue loading game even if image fails
          });
        }
      });
    </script>
  </body>
</html>
